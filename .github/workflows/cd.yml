name: Deploy to Cloud Run

on:
    push:
        branches: [main]

jobs:
    deploy:
        permissions:
            contents: "read"
            id-token: "write"
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Google Auth
              id: auth
              uses: "google-github-actions/auth@v2"
              with:
                  workload_identity_provider: "${{ secrets.WIF_PROVIDER }}"
                  service_account: "${{ secrets.WIF_SERVICE_ACCOUNT }}"

            - id: "deploy"
              uses: "google-github-actions/deploy-cloudrun@v2"
              with:
                  service: "concept"
                  image: "ghcr.io/goodness090807/concept"

            - name: "Use output"
              run: 'curl "${{ steps.deploy.outputs.url }}"'
